# 存储

> Kubernetes 可以存数据方式有很多，大致有两种，持久化存储与非持久化存储。非持久化存储主要是 emptydir，非 emptydir 的基本都是持久存储

> Kubernetes 默认支持很多种存储，有些是内部原生支持，nfs 是内部原生支持；有些是通过接口支持，通过接口支持的好处是可以对接各家的云

## PV 与 PVC
- PV：描述持久化存储卷，定义一个持久化存储在宿主机上的目录，比如一个 NFS 的挂载目录
- PVC：描述 Pod 所希望使用的持久化存储的属性，比如，Volume 存储的大小、可读写权限等等

![](media/16603631618065/16603633661031.jpg)

## StorageClass
> PV 和 PVC 方法虽然能实现屏蔽底层存储，但是 PV 创建比较复杂，通常都是由集群管理员管理，这非常不方便。Kubernetes 提供动态配置 PV 的方法，可以自动创 PV
> - 管理员可以部署 PV 配置器（provisioner），然后定义对应的 StorageClass
> - 开发者在创建 PVC 的时候就可以选择需要创建存储的类型
> - PVC 会把 StorageClass 传递给 PV provisioner，由 provisioner 自动创建 PV

![](media/16603631618065/16603634186705.jpg)

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nfs-csi
provisioner: nfs.csi.k8s.io
parameters:
  server: 192.168.31.229
  share: /data/cloudnative
reclaimPolicy: Delete
volumeBindingMode: Immediate
mountOptions:
  - hard
  - nfsvers=4.1

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-nfs-csi-dynamic
spec:
  accessModes:
    - ReadWriteMany
  resources:
    requests:
      storage: 1Gi
  storageClassName: nfs-cs
```